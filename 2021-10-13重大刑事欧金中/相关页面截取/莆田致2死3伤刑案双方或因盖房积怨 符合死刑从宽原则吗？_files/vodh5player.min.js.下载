(function(e,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a(require("global/window"),require("global/document")):typeof define==="function"&&define.amd?define(["global/window","global/document"],a):(e=e||self,e.vodh5player=a(e.window,e.document))})(this,function(window$1,document){"use strict";window$1=window$1&&Object.prototype.hasOwnProperty.call(window$1,"default")?window$1["default"]:window$1;document=document&&Object.prototype.hasOwnProperty.call(document,"default")?document["default"]:document;var wrapperversion="2.3.13";var wrapperupdate="21-10-23";var vodh5player={};var P2P_FC=["电视剧"];var NOTP2P_FC=[];vodh5player.playerList=[];vodh5player.VJS_ADS_TIMEOUT=6e3;vodh5player.RELEASE=true;vodh5player.DEV=false;if(vodh5player.RELEASE===true){vodh5player.DEV=false}vodh5player.VERSION="";vodh5player.DEBUG_LABEL="[vh5] ";vodh5player.DEBUG=true;vodh5player.debugInfo="";vodh5player.DRM=false;vodh5player.TMP_DRM_CLOSE=false;vodh5player.PLAYER_TYPES=["normal","4k"];vodh5player.DOMAIN=vodh5player.RELEASE?"player.cntv.cn/h5vod/":"jstest.v.cntv.cn/h5vod/";if(vodh5player.DEV===true){vodh5player.DOMAIN="jstest.v.cntv.cn/h5vod/dev/"}vodh5player.HTTP_PRE="https://";vodh5player.VDN_AD_URL="vdnad.apps.cntv.cn/api/getVideoInfoAd.do?";vodh5player.AD_VDN_TIME_OUT=6e3;vodh5player.VDN_URL="vdn.apps.cntv.cn/api/getHttpVideoInfo.do?";vodh5player.VDN_PARA1="&client=flash&im=0";vodh5player.VDN_AD_STATIC_CHECK="47899B86370B879139C08EA3B5E88267";vodh5player.PLAYER_NAME=vodh5player.DRM?"HTML5_VOD_DRM_PLAYER":"HTML5_VOD_PLAYER";vodh5player.PLAY_SCENE="HTML5.PC";vodh5player.APP_NAME="WEB.HTML5.PC";vodh5player.CONFIG_URL="h5vodconfig.json";vodh5player.H5_WORKER="h5.worker";vodh5player.workerLoaded=false;vodh5player.H5_WORKER_NAME="vodh5_"+vodh5player.H5_WORKER;vodh5player.P2P=false;vodh5player.HLSP2P="hlsp2p.js";vodh5player.hlsp2pLoaded=false;vodh5player.HLSP2P_NAME="vodh5_"+vodh5player.HLSP2P;vodh5player.HLSP2P_HAS_INSTANCE_RUNNING=false;vodh5player.CHOOSE_VIDEO_URL="api.cntv.cn/NewVideo/getVideoListByPrimaryPageId?mode=2&sort=asc&n=96&p=1&serviceId=panda";vodh5player.CHOOSE_VIDEO_NAME="vodh5_choosevideo";vodh5player.BARRAGE_CONFIG_URL="www.cntv.cn/pinglun/liuyan/2019dmbq/index.json";vodh5player.convivaOn=false;vodh5player.CONVIVA_URL_1="conviva/conviva-core-sdk.js";vodh5player.CONVIVA_URL_2="conviva/conviva-videojs-module.js";vodh5player.CONVIVA_URL_3="conviva/conviva-vod.js";vodh5player.CONVIVA_URL_NAME_1="vod-conviva-core-sdk-4-0-4";vodh5player.CONVIVA_URL_NAME_2="vod-conviva-videojs-module-4-0-4";vodh5player.CONVIVA_URL_NAME_3="vod-conviva-cctv-4-0-4";vodh5player.alianalyicsOn=true;vodh5player.ALI_ANALYTICS_URL="js.data.cctv.com/__aplus_plugin_cctv.js,aplus_plugin_aplus_u.js";vodh5player.ALI_ANALYTICS_NAME="aliAnalyticsJs237";vodh5player.FINGERPRINT2_URL="js.player.cntv.cn/creator/fingerprint2.js";vodh5player.FINGERPRINT2_NAME="jsFingerLoader";vodh5player.VIDEO_SNAP_URL="";vodh5player.ALI_HEARTBEAT=20;vodh5player.isSafari=navigator.userAgent.indexOf("Safari")>-1&&navigator.userAgent.indexOf("Chrome")==-1;vodh5player.namespace=getvodplayerNS();function getvodplayerNS(){if(vodh5player._namespace===undefined){vodh5player._namespace={}}return vodh5player._namespace}vodh5player.namespace.addConfig=function(e){console.warn(vodh5player.DEBUG_LABEL+"addConfig"+e)};vodh5player.namespace.pauseAllPlayer=function(e){vodh5player.playerList;for(var a=0;a<vodh5player.playerList.length;a++){if(vodh5player.playerList[a].group===e){vodh5player.playerList[a].pause()}}};vodh5player.namespace.debug=function(e){if(e===true){vodh5player.DEBUG=true}else{vodh5player.DEBUG=false}};vodh5player.namespace.getVodPlayer=function(e){if(vodh5player.playerList.length===0){console.warn(vodh5player.DEBUG_LABEL+"there is no players");return null}if(e===undefined){return vodh5player.playerList[vodh5player.playerList.length-1]}else{var a=vodh5player.playerList.length;var r;for(var t=0;t<a;t++){r=vodh5player.playerList[t];if(r&&r.id===e){return r}}}};vodh5player.namespace.getVodPlayers=function(){return vodh5player.playerList};vodh5player.namespace.createVodPlayer=function(e){var a="                                                  \n      :D:          jf                             \n   tWWWWWWW     WWWWWWWW  WWWWWWWWWWEjWW      WW; \n  tWW    .WW   WWW    WWW     WWt     WW      WW  \n  WW,     Wi  jWW      W      WWt     ;WW    WW:  \n  WW          WWD             WWt      WW    WW   \n  WW          WWD             WWt       WW  WW    \n  WW.     KWW LWW      WW     WWt       WWi WW    \n  fWW     WW   WWW    WWW     WWt        WWWW     \n   fWWWWWWW:    WWWWWWWW      WWt        WWWW     \n      :f,          tf                             \n                                                  \n               H5vodplayer Release Wrapper:"+wrapperversion+"\n";window$1.console.log("%c "+a,"color:#ff6868;font-size:8pt;letter-spacing:12pt;line-height:8pt;font-weight:bold;font-family:monospace;");vodh5player.trace("vodh5player creating... at container:"+e.divId);var r={};var t=navigator.userAgent.toLowerCase();var o;(o=t.match(/msie ([\d.]+)/))?r.ie=o[1]:(o=t.match(/firefox\/([\d.]+)/))?r.firefox=o[1]:(o=t.match(/chrome\/([\d.]+)/))?r.chrome=o[1]:(o=t.match(/opera.([\d.]+)/))?r.opera=o[1]:(o=t.match(/version\/([\d.]+).*safari/))?r.safari=o[1]:0;vodh5player.trace(navigator.userAgent);if(r.safari&&!r.chrome){}var d=navigator.userAgent.indexOf("Edge")>-1||navigator.userAgent.indexOf("Edg")>-1;if(d){}if("undefined"!=typeof Conviva){if(Conviva.Analytics===undefined){vodh5player.trace("there is conviva left, clearing ...");Conviva=undefined}}if(typeof getCookie_vdn!=="function"){window.console.warn(vodh5player.DEBUG_LABEL+"lost getCookie_vdn(), check if the dependent file vodplayer.js exist");if(vodh5player.getCookie_vdn("Fingerprint")===undefined||vodh5player.getCookie_vdn("Fingerprint")===""){vodh5player.trace("create new fingerprint")}else{e.fingerprint_uid=vodh5player.getCookie_vdn("Fingerprint");vodh5player.trace("got fingerprint from local:***")}}else{if(getCookie_vdn("Fingerprint")===undefined||getCookie_vdn("Fingerprint")===""){vodh5player.trace("create new fingerprint")}else{e.fingerprint_uid=getCookie_vdn("Fingerprint");vodh5player.trace("got fingerprint from local:***")}}var i=new Vodh5player;i.paramTranslation(e);if(isWasmSupported()){vodh5player.wasmSupported_=true}else{vodh5player.wasmSupported_=false;window$1.console.warn("不支持wasm")}i.loadCore();vodh5player.loadAliAnalyticsJs()};vodh5player.namespace.dispose=function(e,a){vodh5player.trace("disposing ... disposePlugin:"+a);e.shellstructure.dispose(a);var r=false;for(var t=vodh5player.playerList.length-1;t>=0;t--){if(vodh5player.playerList[t]===e){vodh5player.playerList.splice(t,1);r=true;break}}if(!r){console.warn("disposing player isnt in the playerlist")}};vodh5player.getHostName=function(e){if(e.indexOf("//")>-1){var a=e.indexOf("/",8);var r=e.substring(0,a);return r}else{return""}};vodh5player.xhrRequest=function(r){if(String(r)!=="[object Object]"){return undefined}r.method=r.method?r.method.toUpperCase():"GET";r.data=r.data||{};var e=[];for(var a in r.data){e.push("".concat(a,"=",r.data[a]))}r.data=e.join("&");if(r.method==="GET"&&r.data.length>0){r.url+=location.search.length===0?"".concat("?",r.data):"".concat("&",r.data)}var t=new XMLHttpRequest;t.responseType=r.responseType||"json";t.onreadystatechange=function(){if(t.readyState===4){if(t.status===200){if(r.success&&typeof r.success==="function"){r.success(t.response,r.customPara)}}else{if(r.error&&typeof r.error==="function"){r.error()}}}};t.open(r.method,r.url,true);if(r.timeout!==undefined){t.timeout=r.timeout}t.ontimeout=function(e){if(r.ontimeout&&typeof r.ontimeout==="function"){var a={};a.url=r.url;r.ontimeout(a)}};if(r.method==="POST"){t.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}if(r.vtoken!==undefined&&r.vtoken!==""){t.setRequestHeader("vtoken",r.vtoken)}t.send(r.method==="POST"?r.data:null)};vodh5player.loadScript=function(e,a,r,t,o){var d=document.getElementsByTagName("head")[0];var i=document.createElement("script");i.type="text/javascript";i.onload=function(){if(typeof a==="function"){if(o){setTimeout(function(){a(r)},o)}else{a(r)}}};i.onreadystatechange=function(){if(clientInfo.broserVersion>8&&i.readyState==4&&i.status==200||clientInfo.broserVersion<=8&&(i.readyState=="loaded"||i.readyState=="complete")){if(typeof a==="function"){if(o){setTimeout(function(){a(r)},o)}else{a(r)}}}};i.onerror=function(){if(typeof t==="function"){t(r)}};i.src=e;d.appendChild(i)};vodh5player.createElementByType=function(e,a,r,t,o,d,i){var n=document.createElement(e);n.setAttribute("id",a);n.style.position=r;n.style.width=t;n.style.height=o;n.style.left=d;n.style.top=i;return n};vodh5player.removeElementById=function(e){var a=document.getElementById(e);if(a!==null){a.parentNode.removeChild(a)}};vodh5player.loadAliAnalyticsJs=function(){if(document.getElementById(vodh5player.ALI_ANALYTICS_NAME)!==null){vodh5player.trace(">>"+vodh5player.ALI_ANALYTICS_NAME+" already exist")}else{var e=vodh5player.createElementByType("script","","absolute","0px","0px","0px","0px");e.src=vodh5player.HTTP_PRE+vodh5player.ALI_ANALYTICS_URL;var a=document.getElementsByTagName("head")[0];a.appendChild(e);e.onload=function(){vodh5player.trace(">>"+e.src+" loaded");e.id=vodh5player.ALI_ANALYTICS_NAME}}};vodh5player.getCookie_vdn=function(e){var a="";if(document.cookie){var r=document.cookie;var t=r.split("; ");for(var o=0;o<t.length;o++){var d=t[o].split("=");if(d[0]==e){a=d[1].toString();break}}}a+="";try{if((!a||a.length<20)&&window.localStorage){a=localStorage[e]?localStorage[e]:""}}catch(e){a=""}return a};vodh5player.getFingerprint=function(){var e=new Fingerprint2;e.get(function(e){vodh5player.setCookie_vdn("Fingerprint",e.toUpperCase(),7)})};vodh5player.setCookie_vdn=function(e,a,r){if(r){var t=new Date;t.setTime(t.getTime()+r*24*60*60*1e3);document.cookie=e+"="+a+";expires="+t.toGMTString()}else{document.cookie=e+"="+a}try{if(window.localStorage){localStorage.setItem(e,a)}}catch(e){}};vodh5player.getfingerprint2=function(){var e=document.getElementsByTagName("head")[0];var a=vodh5player.createElementByType("script",vodh5player.FINGERPRINT2_NAME,"absolute","0px","0px","0px","0px");a.src=vodh5player.HTTP_PRE+vodh5player.FINGERPRINT2_URL;e.appendChild(a);if(typeof a.onload!="undefined"){a.onload=function(){getFingerprint()}}if(typeof a.onreadystatechange!="undefined"){a.onreadystatechange=function(){if(a.readyState=="loaded"||a.readyState=="complete"){getFingerprint()}}}};vodh5player.trace=function(e,a){var r=new Date;var t=vodh5player.DEBUG_LABEL+"> "+r.getHours()+":"+r.getMinutes()+":"+r.getSeconds()+":"+r.getMilliseconds()+"  "+e;if(vodh5player.DEBUG){if(a===undefined){window$1.console.log(t)}else if(a){window$1.console.warn(t)}}vodh5player.debugInfo+=t+"\r\n"};function Vodh5player(){var this_=this;this_.isSafariPreAdHasShowed_=false;this.debug=vodh5player.DEBUG;this.PRE_AD_URL;this.POST_AD_URL;this.BANNER_AD_URL;this.PAUSE_AD_URL;this.VIDEO_CORE_NAME="vodh5core";this.VIDEO_CORE_URL="video_novhs.min.js";this.VIDEO_LANG_URL="zh-CN.js";this.VIDEO_LANG_NAME="vodh5Lang_"+this.VIDEO_LANG_URL;if(vodh5player.RELEASE){this.VHS_URL="vhs_drm.min.js"}else{this.VHS_URL=vodh5player.DRM?"vhs_drm.min.js":"vhs.min.js"}this.VHS_NAME="vodh5_"+this.VHS_URL;this.VIDEO_CSS_URL="";this.VIDEO_CSS2_URL="";this.config;this.vjsplayer;this.vodParas;this.group;this.HTTP_PRE="https://";this.container_;this.PLAYER_TYPE_INDEX;this.analyticObj={};this.analyticObj.playScene=vodh5player.PLAY_SCENE;this.analyticObj.playerversion=vodh5player.VERSION;this.analyticObj.playerAppname=vodh5player.APP_NAME;this.analyticObj.streamType="vod";this.analyticObj.streamProtocol="HLS";this.analyticObj.playAMR="F";this.analyticObj.P2PStyle="F";this.analyticObj.ready4play1_1=false;this.analyticObj.firstplay=false;this.analyticObj.cumulativeTime=0;this.analyticObj.cumulativeTimeTimer;this.analyticObj.heartbeat;this.analyticObj.freezed=false;this.analyticObj.loadtime=0;this.analyticObj.loadtimeTimer;this.setStartTime_=false;this.preAdVdnTimeOut_;this.preAdVdnTimeOutState_=false;this.postAdVdnTimeOut_;this.postAdVdnTimeOutState_=false;this.firstEnded_===false;this.paramTranslation=function(e){this.vodParas=e;if(e.language!==""&&e.language!=="en"){this.VIDEO_LANG_URL=e.language+".js";this.VIDEO_LANG_NAME="vodh5Lang_"+this.VIDEO_LANG_URL}if(vodh5player.HLSP2P_HAS_INSTANCE_RUNNING){this.vodParas.HLSP2P=true;vodh5player.HLSP2P_HAS_INSTANCE_RUNNING=true}else{this.vodParas.HLSP2P=false}if(undefined!==this.vodParas.cms&&undefined!==this.vodParas.cms.fc){if(P2P_FC.indexOf(this.vodParas.cms.fc)>-1){vodh5player.P2P=true}else{vodh5player.P2P=false}}else{vodh5player.P2P=false}if(vodh5player.P2P){this.analyticObj.P2PStyle="T"}else{this.analyticObj.P2PStyle="F"}vodh5player.trace("p2p:"+(vodh5player.P2P?"on":"off"));this.vodParas.dpr=window.devicePixelRatio;if(this.vodParas.PLAYER_TYPE_INDEX===undefined){this.PLAYER_TYPE_INDEX=0}else{this.PLAYER_TYPE_INDEX=this.vodParas.PLAYER_TYPE_INDEX}vodh5player.trace("player type index:"+this.PLAYER_TYPE_INDEX+" in "+vodh5player.PLAYER_TYPES);if(this.PLAYER_TYPE_INDEX===1){vodh5player.PLAY_SCENE="HTML5.PC.4K";this.analyticObj.playScene=vodh5player.PLAY_SCENE}vodh5player.PLAYER_NAME=vodh5player.DRM?"HTML5_VOD_DRM_PLAYER":"HTML5_VOD_PLAYER";this.group=e.group;switch(e.style){case undefined:case"":this.VIDEO_CSS_URL="./css/vodh5player-v2.min.css";break;case"ipanda":this.VIDEO_CSS_URL="./css/vodh5player-ipanda.min.css";break;default:this.VIDEO_CSS_URL="./css/vodh5player-v2.min.css";break}if(this.vodParas.hasPreAD!==false){this.vodParas.hasPreAD=true}if(this.vodParas.hasPauseAD!==false){this.vodParas.hasPauseAD=true}if(this.vodParas.hasBannerAD!==false){this.vodParas.hasBannerAD=true}if(this.vodParas.hasPostAD!==false){this.vodParas.hasPostAD=true}if(this.vodParas.isHttps===undefined){if(location.href.indexOf("https://")!==-1){this.HTTP_PRE="https://";this.vodParas.isHttps=true;vodh5player.HTTP_PRE="https://"}else{this.HTTP_PRE="http://";this.vodParas.isHttps=false;vodh5player.HTTP_PRE="http://"}vodh5player.trace("para <https> is undefined use pageurl prefix which is "+this.vodParas.isHttps)}else{if(this.vodParas.isHttps===true){this.HTTP_PRE="https://";this.vodParas.isHttps=true;vodh5player.HTTP_PRE="https://"}else{this.HTTP_PRE="http://";this.vodParas.isHttps=false;vodh5player.HTTP_PRE="http://"}}if(this.vodParas.preAdUrl!==undefined){this.PRE_AD_URL=this.vodParas.preAdUrl}if(this.vodParas.postAdUrl!==undefined){this.POST_AD_URL=this.vodParas.postAdUrl}if(this.vodParas.pauseAdUrl!==undefined){this.PAUSE_AD_URL=this.vodParas.pauseAdUrl}if(this.vodParas.bannerAdUrl!==undefined){this.BANNER_AD_URL=this.vodParas.bannerAdUrl}if(this.vodParas.listMode===undefined){this.vodParas.listMode=false}if(this.vodParas.hasBarrage===true&&this.vodParas.barrageApp!==undefined&&this.vodParas.barrageItemId!==undefined&&this.vodParas.barrageType!==undefined){this.vodParas._hasBarrage=true}else{this.vodParas._hasBarrage=false}vodh5player.trace("barrage:"+(this.vodParas._hasBarrage?"on":"off"));if(this.vodParas.setup_autoNext===undefined){this.vodParas.setup_autoNext=true}if(this.vodParas.setup_loop===undefined){this.vodParas.setup_loop=false}if(this.vodParas.ui_cuePoint!==false){this.vodParas.ui_cuePoint=true}if(this.vodParas.autoplay===undefined||this.vodParas.autoplay==="true"||this.vodParas.autoplay===true){this.vodParas.autoplay=true}else if(this.vodParas.autoplay==="false"||this.vodParas.autoplay===false){this.vodParas.autoplay=false}else if(this.vodParas.autoplay==="muted"){this.vodParas.autoplay="muted"}else if(this.vodParas.autoplay==="any"){this.vodParas.autoplay="any"}else{this.vodParas.autoplay=true}vodh5player.trace("autoplay:"+this.vodParas.autoplay);if(this.vodParas.ui_pictureInPicture===undefined){this.vodParas.ui_pictureInPicture=true}if(this.vodParas.chooseVideo===true){vodh5player.trace("开启选集功能，videoAlbum："+this.vodParas.videoAlbum);if(this.vodParas.column_id_pk!==undefined){vodh5player.CHOOSE_VIDEO_URL+="&id="+this.vodParas.column_id_pk}else{vodh5player.CHOOSE_VIDEO_URL+="&id=PAGE1431952477871318"}}};this.loadCore=function(){var e=this;if(document.getElementById("vodh5core")!==null){vodh5player.trace("vodh5core"+" already exist");e.loadVHS()}else{vodh5player.trace("vodh5core"+" loading...");var a=vodh5player.createElementByType("script","","absolute","0px","0px","0px","0px");a.src=this.HTTP_PRE+vodh5player.DOMAIN+this.VIDEO_CORE_URL;var r=document.getElementsByTagName("head")[0];r.appendChild(a);a.onload=function(){vodh5player.trace(">>"+a.src+" loaded");a.id=vodh5player.VIDEO_CORE_NAME;e.loadVHS()}}};this.loadVHS=function(){var e=this;if(document.getElementById(this.VHS_NAME)!==null){vodh5player.trace(">>"+"vodh5_"+this.VHS_URL+" already exist");this.loadPlugins()}else{var a=vodh5player.createElementByType("script","","absolute","0px","0px","0px","0px");a.src=this.HTTP_PRE+vodh5player.DOMAIN+this.VHS_URL;var r=document.getElementsByTagName("head")[0];r.appendChild(a);a.onload=function(){vodh5player.trace(">>"+a.src+" loaded");a.id=this.VHS_NAME;e.loadPlugins()}}};this.loadPlugins=function(){var e=this;if(document.getElementById(this.VIDEO_LANG_NAME)!==null){vodh5player.trace(">>"+this.VIDEO_LANG_NAME+" already exist");if(document.getElementById(vodh5player.H5_WORKER_NAME)!==null){e.loadConfig()}else{e.loadWorker()}}else{var a=vodh5player.createElementByType("script","","absolute","0px","0px","0px","0px");a.src=this.HTTP_PRE+vodh5player.DOMAIN+this.VIDEO_LANG_URL;var r=document.getElementsByTagName("head")[0];r.appendChild(a);a.onload=function(){vodh5player.trace(">>"+a.src+" loaded");a.id=this.VIDEO_LANG_NAME;if(document.getElementById(vodh5player.H5_WORKER_NAME)!==null){e.loadConfig()}else{e.loadWorker()}}}};this.loadWorker=function(){var o=this;vodh5player.trace("loadWorker,"+"wasmSupported:"+vodh5player.wasmSupported_);if(vodh5player.wasmSupported_===false){if(vodh5player.convivaOn){o.loadConvivaJs1()}else{o.loadStyle()}return}if(document.getElementById(vodh5player.H5_WORKER_NAME)!==null){vodh5player.trace(">>"+"vodh5_"+vodh5player.H5_WORKER+" already exist");if(vodh5player.P2P){o.loadHLSP2P()}else{o.loadChooseVideo()}}else{var d=vodh5player.createElementByType("script","","absolute","0px","0px","0px","0px");d.src=this.HTTP_PRE+vodh5player.DOMAIN+vodh5player.H5_WORKER;var e=document.getElementsByTagName("head")[0];e.appendChild(d);d.onload=function(){vodh5player.trace(">>"+d.src+" loaded");d.id=vodh5player.H5_WORKER_NAME;vodh5player.workerLoaded=true;var e=null,a,r=false,t;if(!window.CNTVH5PlayerModule){window.CNTVH5PlayerModule=e}else{e=window.CNTVH5PlayerModule}if(typeof CNTVModule=="function"){e=CNTVModule();window.CNTVH5PlayerModule=e}e.onRuntimeInitialized=function(){vodh5player.trace("worker onRuntimeInitialized");r=true;t=window;window.moduleRoot=window};if(vodh5player.P2P){o.loadHLSP2P()}else{o.loadChooseVideo()}}}};this.loadHLSP2P=function(){var e=this;if(document.getElementById(vodh5player.HLSP2P_NAME)!==null){vodh5player.trace(">>"+"vodh5_"+vodh5player.HLSP2P+" already exist,"+"HLSP2P Version:"+HLSP2P.version);this.loadChooseVideo()}else{var a=vodh5player.createElementByType("script","","absolute","0px","0px","0px","0px");a.src=this.HTTP_PRE+vodh5player.DOMAIN+vodh5player.HLSP2P;a.setAttribute("crossorigin","anonymous");var r=document.getElementsByTagName("head")[0];r.appendChild(a);a.onload=function(){vodh5player.trace(">>"+a.src+" loaded,"+"HLSP2P Version:"+HLSP2P.version);if(!vodh5player.hlsp2pLoaded){a.id=vodh5player.HLSP2P_NAME;vodh5player.hlsp2pLoaded=true}e.loadChooseVideo()}}};this.loadHLSP2P_2=function(){var e=this;if(document.getElementById(vodh5player.HLSP2P_2_NAME)!==null){vodh5player.trace(">>"+"vodh5_"+vodh5player.HLSP2P_2+" already exist");this.loadHLSP2P()}else{var a=vodh5player.createElementByType("script","","absolute","0px","0px","0px","0px");a.src=this.HTTP_PRE+vodh5player.DOMAIN+vodh5player.HLSP2P_2;a.setAttribute("crossorigin","anonymous");var r=document.getElementsByTagName("head")[0];r.appendChild(a);a.onload=function(){vodh5player.trace(">>"+a.src+" loaded");a.id=vodh5player.HLSP2P_2_NAME;vodh5player.hlsp2pLoaded=true;e.loadChooseVideo()}}};this.loadChooseVideo=function(){var e=this;if(e.vodParas.chooseVideo!==true){e.loadConfig();return}if(document.getElementById(vodh5player.CHOOSE_VIDEO_NAME)!==null){vodh5player.trace(">>"+vodh5player.CHOOSE_VIDEO_NAME+" already exist");this.loadConfig()}else{var a=vodh5player.createElementByType("script","","absolute","0px","0px","0px","0px");a.src=this.HTTP_PRE+vodh5player.CHOOSE_VIDEO_URL+"&callback=chooseVideoJsonpHandler";window.chooseVideoJsonpHandler=e.chooseVideoJsonpHandler;var r=document.getElementsByTagName("head")[0];r.appendChild(a);a.onload=function(){vodh5player.trace(">>"+a.src+" loaded");a.id=vodh5player.CHOOSE_VIDEO_NAME;e.loadConfig()}}};this.chooseVideoJsonpHandler=function(e){vodh5player.chooseVideoData=e;delete window.chooseVideoJsonpHandler};this.loadConfig=function(){var a=this;vodh5player.xhrRequest({url:vodh5player.HTTP_PRE+vodh5player.DOMAIN+vodh5player.CONFIG_URL,timeout:1e4,data:{},success:function(e){vodh5player.trace(">>"+vodh5player.HTTP_PRE+vodh5player.DOMAIN+vodh5player.CONFIG_URL+" loaded");a.config=e;if(vodh5player.convivaOn){a.loadConvivaJs1()}else{a.loadStyle()}},error:function(e){vodh5player.trace("config load error"+e);if(vodh5player.convivaOn){a.loadConvivaJs1()}else{a.loadStyle()}}})};this.loadConvivaJs1=function(){var e=this;if(document.getElementById(vodh5player.CONVIVA_URL_NAME_1)!==null){vodh5player.trace(">>"+vodh5player.CONVIVA_URL_NAME_1+" already exist");e.loadConvivaJs2()}else{var a=vodh5player.createElementByType("script","","absolute","0px","0px","0px","0px");a.src=vodh5player.HTTP_PRE+vodh5player.DOMAIN+vodh5player.CONVIVA_URL_1;var r=document.getElementsByTagName("head")[0];r.appendChild(a);a.onload=function(){vodh5player.trace(">>"+String(a.src)+" loaded");a.id=vodh5player.CONVIVA_URL_NAME_1;e.loadConvivaJs2()}}};this.loadConvivaJs2=function(){var e=this;if(document.getElementById(vodh5player.CONVIVA_URL_NAME_2)!==null){vodh5player.trace(">>"+vodh5player.CONVIVA_URL_NAME_2+" already exist");e.loadConvivaJs3()}else{var a=vodh5player.createElementByType("script","","absolute","0px","0px","0px","0px");a.src=vodh5player.HTTP_PRE+vodh5player.DOMAIN+vodh5player.CONVIVA_URL_2;var r=document.getElementsByTagName("head")[0];r.appendChild(a);a.onload=function(){vodh5player.trace(">>"+String(a.src)+" loaded");a.id=vodh5player.CONVIVA_URL_NAME_2;e.loadConvivaJs3()}}};this.loadConvivaJs3=function(){var e=this;if(document.getElementById(vodh5player.CONVIVA_URL_NAME_3)!==null){vodh5player.trace(">>"+vodh5player.CONVIVA_URL_NAME_3+" already exist");e.loadStyle()}else{var a=vodh5player.createElementByType("script","","absolute","0px","0px","0px","0px");a.src=vodh5player.HTTP_PRE+vodh5player.DOMAIN+vodh5player.CONVIVA_URL_3;var r=document.getElementsByTagName("head")[0];r.appendChild(a);a.onload=function(){vodh5player.trace(">>"+String(a.src)+" loaded");a.id=vodh5player.CONVIVA_URL_NAME_3;e.loadStyle()}}};this.loadStyle=function(){if(document.getElementById("vodh5css")!==null){vodh5player.trace(">>"+"vodh5css"+" already exist");this.loadStyle2()}else{var e=document.createElement("link");e.type="text/css";e.rel="stylesheet";e.href=this.HTTP_PRE+vodh5player.DOMAIN+this.VIDEO_CSS_URL;var a=document.getElementsByTagName("head")[0];var r=this;a.appendChild(e);e.onload=function(){vodh5player.trace(">>"+e.href+" has loaded");e.id="vodh5css";r.loadStyle2()}}};this.loadStyle2=function(){if(this.VIDEO_CSS2_URL!==""){if(document.getElementById("vodh5css2")!==null){vodh5player.trace(">>"+"vodh5css2"+" already exist");this.loadChecker()}else{var e=document.createElement("link");e.type="text/css";e.rel="stylesheet";e.href=this.HTTP_PRE+vodh5player.DOMAIN+this.VIDEO_CSS2_URL;var a=document.getElementsByTagName("head")[0];a.appendChild(e);var r=this;e.onload=function(){vodh5player.trace(">>"+e.href+" has loaded");e.id="vodh5css2";r.loadChecker()}}}else{this.loadChecker()}};this.loadChecker=function(){var r=this;vodh5player.trace(">> -- all core & plugins load complete --");if(vodh5player.wasmSupported_===false){r.container_=document.getElementById(r.vodParas.divId);r.container_.className="vdn-novideo-error pic_box";r.container_.innerHTML="<div style='height:50px; top:45%; position: relative;'>您当前的浏览器无法支持该视频播放 <br><br> 请到浏览器官方网站更新版本，或更换其他浏览器和设备</div>";return}vodh5player.trace("checking preAd... hasPreAD:"+this.vodParas.hasPreAD+" PRE_AD_URL:"+this.PRE_AD_URL);if(this.vodParas.hasPreAD&&this.PRE_AD_URL!==""&&this.PRE_AD_URL!==undefined&&this.PRE_AD_URL!==null){var e=this.PRE_AD_URL;if(this.vodParas.preAdsParas){this.vodParas.preAdsParas.length=0;delete this.vodParas.preAdsParas}vodh5player.xhrRequest({url:e,timeout:vodh5player.VJS_ADS_TIMEOUT,data:{},customPara:e,success:function(e,a){vodh5player.trace("preAd loaded. res:");r.parsePreAdsData(e,a)},ontimeout:function(e){vodh5player.trace("preAd load timeout.");r.sendAliAnalytic("/play.1.24","code=999&msg=error1&url="+e.url,false)},error:function(e){vodh5player.trace("preAd load error:"+e);r.parsePreAdsDataError()}})}else{vodh5player.trace("no preAD");this.requestContentVDN(this.vodParas)}};this.parsePreAdsData=function(e,a){vodh5player.trace("parseing pre ad data ...");var r=this.vodParas;if(e&&r.preAdsParas===undefined){try{var t=0;if(Array.isArray(e)){t=e.length}vodh5player.trace("pre ad number:"+t);r.preAdsParas=[];r.preAdsIndex=0;for(var o=0;o<t;o++){if(e[o].guid&&e[o].clickUrl){r.preAdsParas[o]={};r.preAdsParas[o].guid=e[o].guid;r.preAdsParas[o].clickUrl=e[o].clickUrl;r.preAdsParas[o].adStartMonitor=e[o].startcount;r.preAdsParas[o].adMiddleMonitor=e[o].middlecount;r.preAdsParas[o].adMiddleMonitorTime=parseInt(e[o].monitorTime);r.preAdsParas[o].adMonitor3=e[o].eventExposure;r.preAdsParas[o].adMonitor4=e[o].eventExposure1}}}catch(e){v.sendAliAnalytic("/play.1.24","code=998&msg=error2&url="+a,false)}var d=0;d=r.preAdsParas.length;if(d===0){vodh5player.trace("parsePreAdsData: there is no preAd");r.preAdsParas.length=0;delete r.preAdsParas;this.requestContentVDN(r);return}var i=(new Date).getTime().toString().slice(0,10);var n="2049";var s="";var l=r.fingerprint_uid;var p="";var s=md5(i+n+vodh5player.VDN_AD_STATIC_CHECK+l).toUpperCase();for(var h=0;h<d;h++){var c=this.HTTP_PRE+vodh5player.VDN_AD_URL+"pid="+r.preAdsParas[h].guid+vodh5player.VDN_PARA1;c+="&tsp="+i+"&vn="+n+"&vc="+s+"&uid="+l+"&wlan="+p;this.sendAliAnalytic_ad("/play.1.40","ad_url=null"+"&ad_v_id="+r.preAdsParas[h].guid+"&ad_sum="+d+"&ad_num="+(h+1)+"&ad_len="+d*15);var v=this;vodh5player.xhrRequest({url:c,responseType:"json",data:{},customPara:{adindex:h,url:c},success:function(e,a){vodh5player.trace("pread vdn loaded xhr"+a.adindex);v.parsePreAdVdnDataXHR(e,a.adindex,a.url)},ontimeout:function(e){vodh5player.trace("preAd vdn load timeout.");v.sendAliAnalytic("/play.1.24","code=999&msg=error3&url="+e.url,false)},error:function(e){vodh5player.trace("pread vdn load error xhr"+e);v.getPreAdVdnErrorXHR()}})}var v=this;this.preAdVdnTimeOut_=setTimeout(function(){v.sendAliAnalytic("/play.1.24","code=999&msg=error3",false);console.warn(vodh5player.DEBUG_LABEL+"preAdVdnTimeOut timeout ！");v.preAdVdnTimeOutState_=true;v.parseAdVdnDataTimeOut()},vodh5player.AD_VDN_TIME_OUT)}else{vodh5player.trace("no preAd 2");r.preAdsParas.length=0;delete r.preAdsParas;v.requestContentVDN(r)}return d};this.parsePreAdVdnDataXHR=function(e,a,r){var t=this;var o=a;var d=this.vodParas;vodh5player.trace("pre ad:"+o+" vdn data received xhr");if(t.preAdVdnTimeOutState_){return}var i=e;try{d.preAdsParas[o].url=i["hls_url"]}catch(e){t.sendAliAnalytic("/play.1.24","code=998&msg=error4&url="+r,false)}t.sendAliAnalytic_ad("/play.1.41","ad_url="+encodeURIComponent(d.preAdsParas[o].url)+"&ad_v_id="+d.preAdsParas[o].guid+"&ad_sum="+d.preAdsParas.length+"&ad_num="+(o+1)+"&ad_len="+d.preAdsParas.length*15);var n=true;for(var s=0;s<d.preAdsParas.length;s++){if(d.preAdsParas[s].url===undefined){n=false;break}}if(n){clearTimeout(t.preAdVdnTimeOut_);t.requestContentVDN(d)}};this.parseAdVdnDataTimeOut=function(){for(var e=this.vodParas.preAdsParas.length-1;e>=0;e--){if(this.vodParas.preAdsParas[e].url===undefined){console.warn(vodh5player.DEBUG_LABEL+"pre as i:"+e+"timeout !")}}this.preparePreAd()};this.preparePreAd=function(){for(var e=this.vodParas.preAdsParas.length-1;e>=0;e--){if(this.vodParas.preAdsParas[e].url===undefined){this.vodParas.preAdsParas.splice(e,1)}}this.requestContentVDN(this.vodParas)};this.parsePostAdsData=function(e){vodh5player.trace("parsePostAdsData"+e);var a=this.vodParas;if(e&&a.postAdsParas===undefined){var r=0;if(Array.isArray(e)){r=e.length}a.postAdsParas=[];for(var t=0;t<r;t++){if(e[t].guid&&e[t].clickUrl){a.postAdsParas[t]={};a.postAdsParas[t].guid=e[t].guid;a.postAdsParas[t].clickUrl=e[t].clickUrl;a.postAdsParas[t].adStartMonitor=e[t].startcount;a.postAdsParas[t].adMiddleMonitor=e[t].middlecount;a.postAdsParas[t].adMiddleMonitorTime=parseInt(e[t].monitorTime);a.postAdsParas[t].adMonitor3=e[t].eventExposure;a.postAdsParas[t].adMonitor4=e[t].eventExposure1}}vodh5player.trace("post ad number:"+a.postAdsParas.length);var o=0;o=a.postAdsParas.length;if(o===0){vodh5player.trace("there s no postAd ~1");a.postAdsParas.length=0;delete a.postAdsParas;this.vjsplayer.trigger("nopostroll");return}var d=(new Date).getTime().toString().slice(0,10);var i="2049";var n="";var s=a.fingerprint_uid;var l="";var n=md5(d+i+vodh5player.VDN_AD_STATIC_CHECK+s).toUpperCase();for(var p=0;p<o;p++){var h=this.HTTP_PRE+vodh5player.VDN_AD_URL+"pid="+a.postAdsParas[p].guid+vodh5player.VDN_PARA1;h+="&tsp="+d+"&vn="+i+"&vc="+n+"&uid="+s+"&wlan="+l;this.sendAliAnalytic_ad("/play.1.40","ad_url=null"+"&ad_v_id="+a.postAdsParas[p].guid+"&ad_sum="+o+"&ad_num="+(p+1)+"&ad_len="+o*15);var c=this;vodh5player.xhrRequest({url:h,responseType:"json",data:{},customPara:p,success:function(e,a){vodh5player.trace("post ad vdn loaded xhr"+a);c.parsePostAdVdnDataXHR(e,a)},error:function(e){vodh5player.trace("post ad load error xhr"+e);c.getPostAdVdnErrorXHR()}})}var c=this;this.postAdVdnTimeOut_=setTimeout(function(){console.warn(vodh5player.DEBUG_LABEL+"postAdVdnTimeOut timeout ！");c.postAdVdnTimeOutState_=true;c.vjsplayer.trigger("nopostroll")},vodh5player.AD_VDN_TIME_OUT)}else{if(this.debug){window.console.warn(vodh5player.DEBUG_LABEL+"postAd data error")}a.postAdsParas.length=0;delete a.postAdsParas}return o};this.parsePostAdVdnData=function(data){var this_=data.this;var adIndex=data.adIndex;var vodParas=this_.vodParas;vodh5player.trace("parsePostAdVdnData index:"+adIndex);if(this_.postAdVdnTimeOutState_){return}var obj=eval("("+vodAdCallsData+")");vodParas.postAdsParas[adIndex].url=obj["hls_url"];this_.sendAliAnalytic_ad("/play.1.41","ad_url="+encodeURIComponent(vodParas.postAdsParas[adIndex].url)+"&ad_v_id="+vodParas.postAdsParas[adIndex].guid+"&ad_sum="+vodParas.postAdsParas.length+"&ad_num="+(adIndex+1)+"&ad_len="+vodParas.postAdsParas.length*15);var allAdURLLoaded=true;for(var i=0;i<vodParas.postAdsParas.length;i++){if(vodParas.postAdsParas[i].url===undefined){allAdURLLoaded=false;break}}if(allAdURLLoaded){clearTimeout(this_.postAdVdnTimeOut_);vodh5player.trace("all post ad url loaded");this_.startPostAD()}};this.parsePostAdVdnDataXHR=function(e,a){var r=this;var t=r.vodParas;vodh5player.trace("parsePostAdVdnData index:"+a);if(r.postAdVdnTimeOutState_){return}var o=e;t.postAdsParas[a].url=o["hls_url"];r.sendAliAnalytic_ad("/play.1.41","ad_url="+encodeURIComponent(t.postAdsParas[a].url)+"&ad_v_id="+t.postAdsParas[a].guid+"&ad_sum="+t.postAdsParas.length+"&ad_num="+(a+1)+"&ad_len="+t.postAdsParas.length*15);var d=true;for(var i=0;i<t.postAdsParas.length;i++){if(t.postAdsParas[i].url===undefined){d=false;break}}if(d){clearTimeout(r.postAdVdnTimeOut_);vodh5player.trace("all post ad url loaded");r.startPostAD()}};this.requestContentVDN=function(t){var e=this.HTTP_PRE+vodh5player.VDN_URL+"pid="+t.videoId+vodh5player.VDN_PARA1;var a=(new Date).getTime().toString().slice(0,10);var r="2049";var o="";var d="";var i=t.fingerprint_uid;var n="";if(t.vdn!==undefined&&t.vdn.vn!==undefined){r=t.vdn.vn}if(t.vdn!==undefined&&t.vdn.vtoken!==undefined&&t.vdn.vtoken!==""){o=t.vdn.vtoken}var d=md5(a+r+vodh5player.VDN_AD_STATIC_CHECK+i).toUpperCase();e+="&tsp="+a+"&vn="+r+"&vc="+d+"&uid="+i+"&wlan="+n;if(o!==""){e+="&vtokenpos=1"}if(t.vdn!==undefined&&t.vdn.pcv!==undefined){e+="&pcv="+t.vdn.pcv}var s=this;vodh5player.xhrRequest({url:e,vtoken:o,method:"GET",responseType:"text",data:{},customPara:e,success:function(e,a){vodh5player.trace("content vdn loaded");var r=JSON.parse(e);s.parseVodDataFromVdnXhr(t,r,a)},ontimeout:function(e){vodh5player.trace("content vdn timeout.");s.sendAliAnalytic("/play.1.24","code=999&msg=error5&url="+e.url,false)},error:function(e){vodh5player.trace("content vdn load error"+e);s.parseVodDataFromVdnXhrError(t)}})};this.parseVodDataFromVdnXhr=function(a,e,r){vodh5player.trace("parsing content vdn data ...");try{var t=e}catch(e){window.console.warn(vodh5player.DEBUG_LABEL+"content vdn data parse error!");this_.sendAliAnalytic("/play.1.24","code=998&msg=error6&url="+r,false);this.parseVodDataFromVdnXhrError(a);return}try{if(t["ack"]==="no"){this.container_=document.getElementById(a.divId);this.container_.className="vdn-novideo-error pic_box";if(t["status"]==="002"||t["status"]==="003"){this.container_.innerHTML="<div style='height:50px; top:45%; position: relative;'>该视频已下架，请观看其他视频</div>"}else if(t["status"]==="004"){this.container_.innerHTML="<div style='height:50px; top:45%; position: relative;'>该视频不存在</div>"}else if(t["status"]==="006"){this.container_.innerHTML="<div style='height:50px; top:45%; position: relative;'>收费视频未定价</div>"}else if(t["status"]==="007"){this.container_.innerHTML="<div style='height:50px; top:45%; position: relative;'>收费视频无观看权限</div>"}this_.sendAliAnalytic("/play.1.24","code=10001&msg=error7&url="+r,false);return}else if(t["ack"]==="yes"){if(t["public"]==="0"){this.container_=document.getElementById(a.divId);this.container_.className="vdn-novideo-error pic_box";this.container_.innerHTML="<div style='height:50px; top:45%; position: relative;'>您所在的地区，暂不支持播放该视频</div>";return}}if(vodh5player.DRM===true&&vodh5player.TMP_DRM_CLOSE===false){if(t["manifest"]["hls_h5e_url"]===""||t["manifest"]["hls_h5e_url"]===undefined){window.console.warn(vodh5player.DEBUG_LABEL+"content vdn hls_enc_url parse error!");this.parseVodDataFromVdnXhrError(a);return}}else{if(t["hls_url"]===""||t["hls_url"]===undefined){window.console.warn(vodh5player.DEBUG_LABEL+"content vdn hls_url parse error!");this.parseVodDataFromVdnXhrError(a);return}}this.analyticObj.cdnCode=t["hls_cdn_info"]["cdn_code"];this.analyticObj.lc_ip=t["lc"]["ip"];this.analyticObj.lc_coun=t["lc"]["country_code"];this.analyticObj.lc_prov=t["lc"]["provice_code"];this.analyticObj.lc_city=t["lc"]["city_code"];this.analyticObj.lc_isp=t["lc"]["isp_code"];this.analyticObj.client_sid=t["client_sid"];this.analyticObj.column=t["column"];this.analyticObj.channel=t["play_channel"];this.analyticObj.assetName=a.videoId+t["title"];this.analyticObj.public=t["public"];var o=vodh5player.DRM?t["manifest"]["hls_h5e_url"]:t["hls_url"];if(o===undefined){o=t["hls_url"]}this.analyticObj.streamUrl=o;if(a.isHttps){if(o.substr(0,5)==="http:"){o="https:"+o.substr(5);vodh5player.trace("https transition:"+o)}}if(t["video"]["totalLength"]!==undefined&&t["video"]["totalLength"]<=60){vodh5player.trace("video duration is less than 60 seconds");a.hasBannerAD=false;a.hasPauseAD=false;a.hasPreAD=false;a.hasPostAD=false}if(a.ui_cuePoint){a.cuePoints=t["segments"]}a.videoUrl=o;a.defaultStream=t["default_stream"];this.hostName=vodh5player.getHostName(o);var d;if(a.posterImg===undefined||a.posterImg===""){if(t["video"]["chapters3"]&&t["video"]["chapters3"][0]){a.posterImg=d=t["video"]["chapters3"][0]["image"]}}if((a.posterImg===undefined||a.posterImg==="")&&d===undefined){if(t["video"]["chapters4"]&&t["video"]["chapters4"][0]){a.posterImg=d=t["video"]["chapters4"][0]["image"]}}if(t["public"]==="1"&&t["status"]==="001"){this.vjsplayer=this.createVJS(a.divId,o,a.posterImg,a.language);this.vjsplayer.shellstructure=this;vodh5player.playerList.push(this.vjsplayer)}}catch(e){this_.sendAliAnalytic("/play.1.24","code=998&msg=error6&url="+r,false)}};this.parseVodDataFromVdnXhrError=function(e){if(e!==undefined){console.warn(vodh5player.DEBUG_LABEL+"404 parseVodDataFromVdnXhrError "+e.divId);this.container_=document.getElementById(e.divId);this.container_.className="vdn-novideo-error pic_box";this.container_.innerHTML="<div style='height:50px; top:45%; position: relative;'>网络开小差了，请稍后再试</div>"}else{console.warn(vodh5player.DEBUG_LABEL+"404 parseVodDataFromVdnXhrError ")}};this.createVJS=function(e,a,r,t){var o=this.vodParas;var d=false;var i=false;var n=false;var s=false;var l=false;vodh5player.trace("create vjs ...");if(t===undefined||t===""||t===" "){t="zh-CN"}this.container_=document.getElementById(e);var p=document.createElement("source");if(o.videoSrc!==undefined){p.src=o.videoSrc;window.console.warn("test url:"+o.videoSrc)}else{p.src=a}p.type="application/x-mpegURL";var h=document.createElement("video");h.setAttribute("id",e+"_player");h.setAttribute("class","video-js");h.appendChild(p);h.style.position="absolute";h.style.width="100%";h.style.height="100%";h.style.left="0px";h.style.top="0px";this.container_.appendChild(h);var c={wrapperVersion:vodh5player.DEV?"dev "+wrapperversion:wrapperversion,wrapperupdate:wrapperupdate,config:this.config,logicIndex:this.PLAYER_TYPE_INDEX,drmLabel:vodh5player.DRM,debug:this.debug,debugInfo:vodh5player.debugInfo,paras:o,poster:r,vdnDefaultStream:o.defaultStream,controls:true,setup_loop:false,setup_autoNext:true,autoplay:o.autoplay,cuePoints:o.cuePoints,preload:"auto",language:t,playbackRates:[.5,1,1.25,1.5,2],breakpoints:{},responsive:true,userActions:{hotkeys:{muteKey:function(e){return e.which===77},fullscreenKey:function(e){return e.which===70},playPauseKey:function(e){return e.which===80||e.which===32}}},nextImageUrl:""+o.ui_nextImageUrl,nextTitle:""+o.ui_nextTitle,controlBar:{nextPanel:o.listMode,currentTimeDisplay:true,remainingTimeDisplay:false,seekToLive:false,customControlSpacer:true,audioModeButton:false,playbackQualityMenuButton:o.ui_quality,playbackQualityLabels:o.playbackQualityLabels,playbackRateMenuButton:o.ui_rate,chooseVideoButton:o.chooseVideo===true?true:false,descriptionsButton:false,subsCapsButton:false,audioTrackButton:false,setupMenuButton:o.ui_setup,fullscreenToggle:o.ui_fullScreen,webfullscreenToggle:o.ui_webFullScreen,volumePanel:{inline:false}},pictureInPictureToggle:o.ui_pictureInPicture,videoSnapUrl:vodh5player.VIDEO_SNAP_URL,barrageVod:o.barrageType==="video"?true:false,barrageConfigUrl:vodh5player.BARRAGE_CONFIG_URL,barrageContentUrl:o.barrageType==="video"?"common.newcomment.cntv.cn/data/pandabarrage?":"common.newcomment.cntv.cn/comment/list?",hasBarrage:o._hasBarrage,barrageApp:o.barrageApp,barrageItemId:o.barrageItemId,chooseVideoPanel:o.chooseVideo===true?true:false,chooseVideoData:vodh5player.chooseVideoData,html5:{nativeCaptions:false,nativeAudioTracks:false,nativeVideoTracks:false,hls:{debug:true,overrideNative:true}},isHttps:o.isHttps,pauseAd:o.hasPauseAD,pauseAdUrl:this.PAUSE_AD_URL,bannerAd:o.hasBannerAD,bannerAdUrl:this.BANNER_AD_URL};var v=this;var y=videojs(h.getAttribute("id"),c,function(){if(v.debug){window.console.log(vodh5player.DEBUG_LABEL+"player s ready, core version:"+videojs.VERSION+"-"+videojs.UPDATE_DATE+"-"+videojs.PLAYER_VERSION)}vodh5player.VERSION=videojs.PLAYER_VERSION;v.analyticObj.playerversion=vodh5player.VERSION;if(vodh5player.convivaOn){if(!this.convivaIntegration){vodh5player.trace("conviva init");var e={};e.ASSET_NAME=o.videoId;e.VIEWER_ID=o.fingerprint_uid;e.PLAYER_NAME=vodh5player.PLAYER_NAME;e.APP_VERSION=vodh5player.VERSION;e.PLAY_SCENE=vodh5player.PLAY_SCENE;e.APP_NAME=vodh5player.APP_NAME;e.P2P=vodh5player.P2P;e["cdnCode"]=v.analyticObj.cdnCode;e["lc_coun"]=v.analyticObj.lc_coun;e["lc_prov"]=v.analyticObj.lc_prov;e["lc_city"]=v.analyticObj.lc_city;e["lc_isp"]=v.analyticObj.lc_isp;e["wrapperversion"]=vodh5player.DEV?"dev "+wrapperversion:wrapperversion;try{this.convivaIntegration=new ConvivaIma3IntegrationVod(this,e)}catch(e){console.warn("conviva Error:"+e.message)}}}v.analyticObj.createTime=Math.round((new Date).getTime()/1e3);v.sendAliAnalytic("/play.1.3");if(o.startTime!==undefined&&o.startTime!==""&&o.startTime!==null&&o.startTime!==" "){y.currentTime(o.startTime);vodh5player.trace("video start at:"+o.startTime+"s")}else{var a=y.getSavedPosition(o.videoId);y.currentTime(a);vodh5player.trace("video start at savedPosition: "+a)}y.on("timeupdate",function(){if(v.currentTimeSec_!==Math.round(y.currentTime())){v.currentTimeSec_=Math.round(y.currentTime());y.saveVideoPosition(o.videoId)}if(vodh5player.isSafari&&!y.ads.isInAdMode()&&y.currentTime()>.1&&!v.isSafariPreAdHasShowed_){vodh5player.trace(" safari 开始广告");v.isSafariPreAdHasShowed_=true;v.readyForPreroll(y)}});y.on("adtimeupdate",function(){if(undefined!==o.preAdsParas&&o.preAdsParas.length>=0){var e=o.preAdsParas[o.preAdsIndex].adMiddleMonitor;var a=o.preAdsParas[o.preAdsIndex].adMiddleMonitorTime;if(undefined!==e&&undefined!==a&&e!==""&&e!==null){if(Math.round(y.currentTime())===a){o.preAdsParas[o.preAdsIndex].adMiddleMonitor="";vodh5player.xhrRequest({url:e,data:{}})}}}});y.on("readyforpreroll",function(){i=true;vodh5player.trace("ADS readyforpreroll _ifPrerollReady:"+i);if(l){console.warn(vodh5player.DEBUG_LABEL+"ADS PREROLL TIMEOUT !");return}if(d){i=null;d=null;if(!vodh5player.isSafari){v.readyForPreroll(y)}}if(vodh5player.isSafari){y.trigger("nopreroll")}});y.on("readyforpostroll",function(){vodh5player.trace("<player>e: readyforpostroll");v.readyForPostroll(y)});y.on("adsready",function(){vodh5player.trace("<player>e: adsready")});y.on("adstart",function(){vodh5player.trace("<player>e: adstart")});y.on("adend",function(){vodh5player.trace("<player>e: adend")});y.on("adskip",function(){vodh5player.trace("<player>e: adskip")});y.on("adtimeout",function(){vodh5player.trace("<player>e: adtimeout");l=true});y.on("firstplay",function(){vodh5player.trace("<player>e: firstplay")});y.on("nextvideo",function(){vodh5player.trace("<player>e: NextVideo");try{NextVideo()}catch(e){console.warn(vodh5player.DEBUG_LABEL+" disappearance function NextVideo")}});y.on("enterFullWindow",function(){vodh5player.trace("<player>e: enterFullWindow");if(typeof changeWindowToWebFullSceen==="function"){changeWindowToWebFullSceen(this.id())}});y.on("exitFullWindow",function(){vodh5player.trace("<player>e: exitFullWindow");if(typeof changeWindowToNormalSceen==="function"){changeWindowToNormalSceen(this.id())}});y.on("changeHLSP2P",function(e){vodh5player.trace("changeHLSP2P:"+v.vodParas.videoId);if(!vodh5player.P2P){vodh5player.trace("cancel p2p");return}vodh5player.trace(v.hostName+e.level.id.substr(2));if(vodh5player.hlsp2pLoaded){var a=v.hostName+e.level.id.substr(2);vodh5player.trace(" HLSP2P start");if("undefined"!=typeof HLSP2P&&HLSP2P.isSupported()){if(window.vjsp2p!==undefined){window.vjsp2p.destroy();window.vjsp2p=null}window.vjsp2p=HLSP2P.createCommon({videoId:y.el().getElementsByTagName("video")[0].id,url:a});window.vjsp2p.on(HLSP2P.Events.Rollback,function(){window.vjsp2p.destroy()})}}});y.on("changeAudioMode",function(e){switch(e.audioMode){case 0:if(v.liveAudio!==undefined){v.liveAudio.dislinkerDest()}break;case 1:if(v.liveAudio!==undefined){v.liveAudio.connectDestHeadset()}break;case 2:if(v.liveAudio!==undefined){v.liveAudio.connectDestLoudspeaker()}break}});if(o.preAdsParas&&o.preAdsParas.length>0){y.addClass("ads");y.trigger("adsready")}else{vodh5player.trace("ADS nopreroll 1");v.analyticObj.ready4play1_1=true;y.trigger("nopreroll")}v.container_.dispatchEvent(new Event("vodplayerready"))});y.ready(function(){if(s){vodh5player.trace("trigger loadstart again");y.trigger("loadstart");s=false}});y.addClass("whs");y.on("loadstart",function(){vodh5player.trace("<player>e: loadstart");n=true});y.on("error",function(){vodh5player.trace("vjs error,code:"+y.error_.code+",msg:"+y.error_.message);v.sendAliAnalytic("/play.1.4","msg="+y.error_.message,false)});y.on("ended",function(){vodh5player.trace("<player>e: ended");if(y.isInPictureInPicture()){y.exitPictureInPicture()}v.contentEnded()});y.on("loadedmetadata",function(){if(d===false){d=true}vodh5player.trace("<player>e: loadedmetadata");if(l){console.warn(vodh5player.DEBUG_LABEL+"ADS PREROLL TIMEOUT !");return}if(i){v.readyForPreroll(y);i=null;d=null}});y.on("loadeddata",function(){vodh5player.trace("<player>e: loadeddata");if(v.vodParas.preAdsParas===undefined||v.vodParas.preAdsParas.length<=0){v.sendAliAnalytic("/play.1.6")}if(vodh5player.isSafari){}});y.on("play",function(){vodh5player.trace("<player>e: play");if(vodh5player.playerList.length>1){var e=vodh5player.playerList.length;for(var a=0;a<e;a++){if(vodh5player.playerList[a]!==this&&vodh5player.playerList[a].shellstructure.group===this.shellstructure.group){vodh5player.playerList[a].pause()}}}var r=document.querySelectorAll("audio");for(var t=0;t<r.length;t++){r[t].pause()}});y.on("pause",function(){vodh5player.trace("<player>e: pause");v.sendAliAnalytic("/play.1.7")});y.on("analyticALI.play.1.13",function(){vodh5player.trace("<player>e: analyticALI.play.1.13:");v.sendAliAnalytic("/play.1.13")});y.on("analyticALI.play.1.14",function(){vodh5player.trace("<player>e: analyticALI.play.1.14:");v.sendAliAnalytic("/play.1.14")});y.on("analyticALI.play.1.17",function(){vodh5player.trace("<player>e: analyticALI.play.1.17");v.sendAliAnalytic("/play.1.17")});y.on("sourceset",function(e){vodh5player.trace("<player>e: sourceset")});y.on("waiting",function(e){vodh5player.trace("<player>e: waiting");v.sendAliAnalytic("/play.1.18");if(v.analyticObj!==undefined){v.analyticObj.freezed=true}});y.on("playing",function(e){vodh5player.trace("<player>e: playing");if(v.analyticObj.ready4play1_1&&!v.analyticObj.firstplay){v.analyticObj.ready4play1_1=false;v.analyticObj.firstplay=true;v.analyticObj.cumulativeTime=0;v.analyticObj.cumulativeTimeTimer=setInterval(v.cumulativeTimeStep,1e3,v);v.analyticObj.heartbeat=setInterval(v.aliHeartbeat,vodh5player.ALI_HEARTBEAT*1e3,v);v.sendAliAnalytic("/play.1.1")}});y.on("canplay",function(e){vodh5player.trace("<player>e: canplay")});y.on("canplaythrough",function(e){vodh5player.trace("<player>e: canplaythrough");if(v.analyticObj!==undefined&&v.analyticObj.freezed===true){v.sendAliAnalytic("/play.1.19");v.analyticObj.freezed=false}});y.on("seeking",function(e){vodh5player.trace("<player>e: seeking");if(y.currentTime()!==0){v.sendAliAnalytic("/play.1.15")}});y.on("durationchange",function(e){vodh5player.trace("<player>e: durationchange"+y.duration());vodh5player.trace("<player>e: currentTime"+y.currentTime())});y.on("fullscreenchange",function(e){vodh5player.trace("<player>e: fullscreenchange");if(y.isFullscreen()){v.sendAliAnalytic("/play.1.8")}else{v.sendAliAnalytic("/play.1.9")}});y.on("enterpictureinpicture",function(e){vodh5player.trace("<player>e: enterpictureinpicture")});y.on("leavepictureinpicture",function(e){vodh5player.trace("<player>e: leavepictureinpicture")});y.on("ratechange",function(e){vodh5player.trace("<player>e: ratechange")});y.on("qualitychange",function(e){vodh5player.trace("<player>e: qualitychange")});y.on("volumechange",function(e){vodh5player.trace("<player>e: volumechange");v.sendAliAnalytic("/play.1.16")});return y};this.readyForPreroll=function(t){var o=this;var d=this.vodParas;if(this.debug){vodh5player.trace("readyForPreroll() hasPreAD:"+d.hasPreAD);if(d.preAdsParas){vodh5player.trace("preAds:"+d.preAdsParas.length)}}var i=0;if(!d.hasPreAD||d.preAdsParas===undefined||d.preAdsParas.length===0){vodh5player.trace("ADS nopreroll 2");o.analyticObj.ready4play1_1=true;t.setAdsLabel();t.trigger("nopreroll");return}t.ads._state.adsReady=true;t.ads.startLinearAdMode();t.setAdsLabel(""+(i+1)+"/"+d.preAdsParas.length+"",d.preAdsParas[i].clickUrl);t.src({src:""+d.preAdsParas[i].url,type:"application/x-mpegURL"});var e=d.preAdsParas[i].adStartMonitor;if(e!==null&&e!==undefined&&e!==""){vodh5player.xhrRequest({url:e,data:{}})}var a=d.preAdsParas[i].adMonitor3;if(a!==null&&a!==undefined&&a!==""){vodh5player.xhrRequest({url:a,data:{}})}var r=d.preAdsParas[i].adMonitor4;if(r!==null&&r!==undefined&&r!==""){vodh5player.xhrRequest({url:r,data:{}})}t.on("adplaying",function(){vodh5player.trace("pre adplaying trigger ads-ad-started");t.trigger("ads-ad-started");if(d.preAdsParas[i].sent!==true){d.preAdsParas[i].sent=true;o.sendAliAnalytic_ad("/play.1.42","ad_url="+encodeURIComponent(d.preAdsParas[i].url)+"&ad_v_id="+d.preAdsParas[i].guid+"&ad_sum="+d.preAdsParas.length+"&ad_num="+(i+1)+"&ad_len="+d.preAdsParas.length*15)}});t.on("adended",function(){vodh5player.trace("ADS pre adended");o.sendAliAnalytic_ad("/play.1.43","ad_url="+encodeURIComponent(d.preAdsParas[i].url)+"&ad_v_id="+d.preAdsParas[i].guid+"&ad_sum="+d.preAdsParas.length+"&ad_num="+(i+1)+"&ad_len="+d.preAdsParas.length*15);i++;if(i<d.preAdsParas.length){d.preAdsIndex=i;t.setAdsLabel(""+(i+1)+"/"+d.preAdsParas.length+"",d.preAdsParas[i].clickUrl);t.src({src:""+d.preAdsParas[i].url,type:"application/x-mpegURL"});var e=d.preAdsParas[i].adStartMonitor;if(e!==null&&e!==undefined&&e!==""){vodh5player.xhrRequest({url:e,data:{}})}var a=d.preAdsParas[i].adMonitor3;if(a!==null&&a!==undefined&&a!==""){vodh5player.xhrRequest({url:a,data:{}})}var r=d.preAdsParas[i].adMonitor4;if(r!==null&&r!==undefined&&r!==""){vodh5player.xhrRequest({url:r,data:{}})}}else{d.preAdsIndex=0;o.analyticObj.ready4play1_1=true;t.setAdsLabel();t.ads.endLinearAdMode();t.off("adended");t.off("adplaying");o.sendAliAnalytic("/play.1.6")}})};this.readyForPostroll=function(e){vodh5player.trace("readyForPostroll() hasPostAD:"+this.vodParas.hasPostAD);if(!this.vodParas.hasPostAD||this.POST_AD_URL===undefined){vodh5player.trace("ADS nopostroll 1"+this.POST_AD_URL);e.trigger("nopostroll");return}var a=this.POST_AD_URL;if(this.vodParas.postAdsParas){this.vodParas.postAdsParas.length=0;delete this.vodParas.postAdsParas}var r=this;vodh5player.xhrRequest({url:a,timeout:vodh5player.VJS_ADS_TIMEOUT,data:{},success:function(e){vodh5player.trace("postad loaded "+e);if(e===null){r.parsePostAdsDataError(null)}else{r.parsePostAdsData(e)}},error:function(e){vodh5player.trace("postad load error"+e);r.parsePostAdsDataError(e)}})};this.startPostAD=function(){var e=0;var a=this.vodParas;var r=this.vjsplayer;var t=this;if(r.isInPictureInPicture()){r.exitPictureInPicture()}r.ads.startLinearAdMode();r.setAdsLabel(""+(e+1)+"/"+a.postAdsParas.length+"",a.postAdsParas[e].clickUrl);r.src({src:""+a.postAdsParas[e].url,type:"application/x-mpegURL"});r.on("adplaying",function(){vodh5player.trace("post adplaying trigger ads-ad-started");r.trigger("ads-ad-started");if(a.postAdsParas[e].sent!==true){a.postAdsParas[e].sent=true;t.sendAliAnalytic_ad("/play.1.42","ad_url="+encodeURIComponent(a.postAdsParas[e].url)+"&ad_v_id="+a.postAdsParas[e].guid+"&ad_sum="+a.postAdsParas.length+"&ad_num="+(e+1)+"&ad_len="+a.postAdsParas.length*15)}});r.on("adended",function(){vodh5player.trace("ADS post adended");t.sendAliAnalytic_ad("/play.1.43","ad_url="+encodeURIComponent(a.postAdsParas[e].url)+"&ad_v_id="+a.postAdsParas[e].guid+"&ad_sum="+a.postAdsParas.length+"&ad_num="+(e+1)+"&ad_len="+a.postAdsParas.length*15);e++;if(e<a.postAdsParas.length){r.setAdsLabel(""+(e+1)+"/"+a.postAdsParas.length+"",a.postAdsParas[e].clickUrl);r.src({src:""+a.postAdsParas[e].url,type:"application/x-mpegURL"})}else{vodh5player.trace("all post over");r.setAdsLabel();r.ads.endLinearAdMode();r.off("adended");r.off("adplaying")}})};this.contentEnded=function(){vodh5player.trace(" contentEnded()");var e=this.vjsplayer;this.isSafariPreAdHasShowed_=false;if(e.loop2()){e.currentTime(0);e.play()}else{try{PlayComplete()}catch(e){console.warn(vodh5player.DEBUG_LABEL+" disappearance function PlayComplete ,contentEnded")}if(e.autoNext()===true){try{NextVideo()}catch(e){console.warn(vodh5player.DEBUG_LABEL+" disappearance function NextVideo ,contentEnded")}}}};this.getPreAdVdnError=function(e){console.warn(vodh5player.DEBUG_LABEL+"getPreAdVdnError !"+e)};this.getPreAdVdnErrorXHR=function(e){console.warn(vodh5player.DEBUG_LABEL+"getPreAdVdnErrorXHR !"+e)};this.getPostAdVdnError=function(e){console.warn(vodh5player.DEBUG_LABEL+"getPostAdVdnError !"+e)};this.getPostAdVdnErrorXHR=function(e){console.warn(vodh5player.DEBUG_LABEL+"getPostAdVdnErrorXHR !"+e)};this.parsePreAdsDataError=function(){console.warn(vodh5player.DEBUG_LABEL+"parsePreAdsDataError !");this.requestContentVDN(this.vodParas)};this.parsePostAdsDataError=function(e){console.warn(vodh5player.DEBUG_LABEL+"parsePostAdsDataError !"+e);this.vjsplayer.trigger("nopostroll")};this.dispose=function(e){vodh5player.trace("disposing :"+this.vjsplayer.id());if(window.vjsp2p!==undefined){vodh5player.trace("destroy window.vjsp2p");window.vjsp2p.destroy();window.vjsp2p=null}if(this.liveAudio!==undefined){}if("undefined"!==typeof convivaVideoAnalytics){vodh5player.trace("cleaning conviva :"+this.vjsplayer.id());convivaVideoAnalytics.reportPlaybackEnded();convivaVideoAnalytics.release();convivaVideoAnalytics=null;videoPlayer.convivaVideoAnalytics=null;Conviva.Analytics.release()}vodh5player.removeElementById(vodh5player.CONVIVA_URL_NAME_1);vodh5player.removeElementById(vodh5player.CONVIVA_URL_NAME_2);vodh5player.removeElementById(vodh5player.CONVIVA_URL_NAME_3);vodh5player.removeElementById(vodh5player.ALI_ANALYTICS_NAME);vodh5player.removeElementById(vodh5player.FINGERPRINT2_NAME);vodh5player.removeElementById(this.VIDEO_CORE_NAME);vodh5player.removeElementById(this.VHS_NAME);vodh5player.removeElementById(this.VIDEO_LANG_NAME);this.sendAliAnalytic("/play.1.5");clearInterval(this.analyticObj.heartbeat);clearInterval(this.analyticObj.cumulativeTimeTimer);this.vjsplayer.dispose()};this.sendAliAnalytic=function(e,a,r){var t="";var o="";var d="";if(a!=undefined){o+=a}if(r===undefined){var i=this.analyticObj;o+="&playScene="+vodh5player.PLAY_SCENE;o+="&playerName="+vodh5player.PLAYER_NAME;o+="&playerversion="+i.playerversion;o+="&streamType="+i.streamType;o+="&streamProtocol="+i.streamProtocol;o+="&playAMR="+i.playAMR;if(this.vjsplayer!==undefined){if(this.vjsplayer.getCurentBitrate()!==null){o+="&bit="+this.vjsplayer.getCurentBitrate()}else{o+="&bit="+0}o+="&loadtime="+i.loadtime}else{o+="&bit="+0;o+="&loadtime="+0}o+="&playtime="+this.analyticObj.cumulativeTime;o+="&playing="+this.vjsplayer.isPlaying();if(this.vjsplayer.getQualityLevels()){o+="&streamMBR="+this.vjsplayer.getQualityLevels().length}o+="&v_id="+this.vodParas.videoId;o+="&referURL="+encodeURIComponent(document.referrer);o+="&curURL="+encodeURIComponent(window.location.href);o+="&createTime="+i.createTime;o+="&streamUrl="+encodeURIComponent(i.streamUrl);o+="&cdnCode="+i.cdnCode;o+="&lc_ip="+i.lc_ip;o+="&lc_coun="+i.lc_coun;o+="&lc_prov="+i.lc_prov;o+="&lc_city="+i.lc_city;o+="&lc_isp="+i.lc_isp;o+="&client_sid="+i.client_sid;o+="&column="+i.column;o+="&channel="+i.channel;o+="&assetName="+i.assetName;o+="&public="+i.public;o+="&unixts="+Math.round((new Date).getTime()/1e3)}if(typeof goldlog!=="undefined"){goldlog.record(e,t,o,d)}else{vodh5player.trace("lost alianlytic",true)}};this.sendAliAnalytic_ad=function(e,a){var r="";var t="";var o="";if(a!=undefined){t+=a}var d=this.analyticObj;t+="&playScene="+vodh5player.PLAY_SCENE;t+="&playerversion="+d.playerversion;if(this.vjsplayer!==undefined){if(this.vjsplayer.getCurentBitrate()!==null){t+="&bit="+this.vjsplayer.getCurentBitrate()}else{t+="&bit="+0}t+="&loadtime="+d.loadtime}else{t+="&bit="+0;t+="&loadtime="+0}t+="&v_id="+this.vodParas.videoId;t+="&type=vod";t+="&referURL="+encodeURIComponent(document.referrer);t+="&curURL="+encodeURIComponent(window.location.href);t+="&createTime="+d.createTime;t+="&cdnCode="+d.cdnCode;t+="&column="+d.column;t+="&channel="+d.channel;if(typeof goldlog!=="undefined"){goldlog.record(e,r,t,o)}else{if(this.debug){window.console.warn(vodh5player.DEBUG_LABEL+"lost alianlytic")}}};this.cumulativeTimeStep=function(e){if(e.vjsplayer&&e.vjsplayer.isPlaying()&&e.vjsplayer.ads&&e.vjsplayer.ads.isInAdMode()===false){e.analyticObj.cumulativeTime++}};this.aliHeartbeat=function(e){e.sendAliAnalytic("/play.1.2")}}return vodh5player});